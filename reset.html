<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reset Password — RSPS</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:0; background:#f8fafc; color:#111827; }
    .wrap { max-width:460px; margin:8vh auto; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; }
    input, button { width:100%; padding:10px; border-radius:10px; border:1px solid #d1d5db; font-size:14px; }
    button { background:#0b6ef3; color:#fff; border:0; font-weight:700; margin-top:8px; cursor:pointer; }
    .msg { margin-top:10px; font-size:14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Set a new password</h2>
    <p class="msg" id="status">Checking reset link…</p>
    <input id="pwd" type="password" placeholder="New password" />
    <button id="save">Update Password</button>
    <p class="msg" id="out"></p>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const sb = supabase.createClient(
      "https://eqbbddsjutlupckqzlpq.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxYmJkZHNqdXRsdXBja3F6bHBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NDkzOTMsImV4cCI6MjA3MDIyNTM5M30.CVmsiBCCp98ZQQOEe-1QgrvcJGeRP4DGHUx6j0wPCRI"
    );

    // When this page opens from the email link, Supabase includes a session in the URL hash.
    // Supabase JS v2 will read it and create a session automatically.
    (async () => {
      const { data: { user }, error } = await sb.auth.getUser();
      const s = document.getElementById('status');
      if (error || !user) {
        s.textContent = "Reset session not found. Please open the link from the email again.";
      } else {
        s.textContent = `Hi ${user.email || ''}, please set a new password.`;
      }
    })();

    document.getElementById('save').onclick = async () => {
      const password = document.getElementById('pwd').value;
      const out = document.getElementById('out');
      if (!password || password.length < 6) { out.textContent = "Password must be at least 6 characters."; return; }
      const { error } = await sb.auth.updateUser({ password });
      if (error) { out.style.color = "#ef4444"; out.textContent = error.message; }
      else { out.style.color = "#10b981"; out.textContent = "Password updated. You can close this tab and log in."; }
    };
  </script>
</body>
</html>
