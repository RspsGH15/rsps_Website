<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Rising Stars Public School | Welcome</title>
<meta content="Official website of Rising Stars Public School. Simple, mobile-friendly site with About, Admissions, Gallery, Enquiry, and Contact." name="description"/>
<style>
  :root { --brand:#0b6ef3; --brand-dark:#094fb1; --ink:#1f2937; --muted:#6b7280; --bg:#f8fafc; --card:#fff; --accent:#10b981; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;color:var(--ink);background:var(--bg)}
  a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
  .container{max-width:1100px;margin:0 auto;padding:0 16px}

  header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.95);backdrop-filter:blur(6px);border-bottom:1px solid #e5e7eb}
  .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px}
  .brand img.logo{height:36px;width:auto;border-radius:6px}
  .menu{display:flex;gap:14px;align-items:center}
  .menu a{padding:8px 10px;border-radius:8px;font-weight:600;color:var(--ink)}
  .menu a:hover{background:#eef2ff;text-decoration:none}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;font-weight:700;color:#fff;background:var(--brand)}
  .btn:hover{background:var(--brand-dark)}
  .btn-outline{color:var(--brand);background:#fff;border:1px solid var(--brand)}
  .btn-outline:hover{background:#eef2ff}

  .hamburger{display:none;background:transparent;border:0;font-size:22px;padding:6px 8px}
  #mobileMenu{display:none;border-top:1px solid #e5e7eb}
  #mobileMenu a{display:block;padding:12px 8px}
  @media (max-width:860px){.menu{display:none}.hamburger{display:block} #mobileMenu.open{display:block}}

  .hero{background:linear-gradient(180deg,#e0f2fe 0%,#f8fafc 100%);padding:36px 0 26px;border-bottom:1px solid #e5e7eb}
  .hero h1{font-size:clamp(24px,4vw,38px);margin:0 0 8px}
  .hero p{color:var(--muted);margin:0 0 18px;font-size:16px}
  .hero-cta{display:flex;flex-wrap:wrap;gap:10px}

  .grid{display:grid;gap:14px;grid-template-columns:repeat(3,1fr)}
  @media (max-width:860px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .card h3{margin:0 0 6px;font-size:18px}
  .card p{margin:0 0 10px;color:var(--muted)}

  section{padding:28px 0}
  .section-title{font-size:22px;margin:0 0 12px}

  .gallery{display:grid;gap:10px;grid-template-columns:repeat(4,1fr)}
  @media (max-width:860px){.gallery{grid-template-columns:repeat(2,1fr)}}
  .gallery img{width:100%;height:140px;object-fit:cover;border-radius:12px;border:1px solid #e5e7eb}

  form.enquiry{display:grid;gap:10px;grid-template-columns:1fr 1fr;background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
  form.enquiry label{font-weight:600;font-size:14px}
  form.enquiry input,form.enquiry select,form.enquiry textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #d1d5db;font-size:14px}
  form.enquiry textarea{min-height:90px;grid-column:1/-1}
  form.enquiry .actions{grid-column:1/-1;display:flex;gap:10px;flex-wrap:wrap}

  .contact{display:grid;gap:16px;grid-template-columns:1.2fr 1fr}
  @media (max-width:860px){.contact{grid-template-columns:1fr}}
  .info{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:16px}

  footer{margin-top:24px;padding:20px 0;background:#0f172a;color:#e2e8f0}
  footer a{color:#bfdbfe}
  .foot{display:grid;gap:16px;grid-template-columns:1fr 1fr 1fr}
  @media (max-width:860px){.foot{grid-template-columns:1fr}}
  .small{color:#94a3b8;font-size:13px}
</style>
</head>
<body>
<script>
  // If a password recovery link lands on index.html with a hash, forward it to reset.html
  if (location.hash && location.hash.includes('type=recovery')) {
    location.replace('reset.html' + location.hash);
  }
</script>

<header>
  <div class="container nav">
    <div class="brand">
      <img alt="Rising Stars Public School Logo" class="logo" src="Rising Stars logo RSPS png.png"/>
      <div>Rising Stars Public School</div>
    </div>
    <nav aria-label="Primary" class="menu">
      <a href="#home">Home</a>
      <a href="#about">About Us</a>
      <a href="#admissions">Admissions</a>
      <a href="#gallery">Image Gallery</a>
      <a href="#enquiry">Enquiry</a>
      <a href="#contact">Contact Us</a>
      <a class="btn" href="#login">Login</a>
    </nav>
    <button aria-label="Open menu" class="hamburger" onclick="toggleMenu()">☰</button>
  </div>
  <div aria-label="Mobile" class="container" id="mobileMenu">
    <a href="#home" onclick="toggleMenu()">Home</a>
    <a href="#about" onclick="toggleMenu()">About Us</a>
    <a href="#admissions" onclick="toggleMenu()">Admissions</a>
    <a href="#gallery" onclick="toggleMenu()">Image Gallery</a>
    <a href="#enquiry" onclick="toggleMenu()">Enquiry</a>
    <a href="#contact" onclick="toggleMenu()">Contact Us</a>
    <a class="btn" href="#login" onclick="toggleMenu()">Login</a>
  </div>
</header>

<main class="hero" id="home">
  <div class="container">
    <h1>Welcome to Rising Stars Public School</h1>
    <p>We believe in <strong>Parampara : Prodyogiki : Prakastha</strong> – “Tradition, Technology, Excellence.” <strong>सरल भाषा – आसान जानकारी.</strong></p>
    <div class="hero-cta">
      <a class="btn" href="#admissions">Apply for Admission</a>
      <a class="btn btn-outline" href="#enquiry">Ask a Question</a>
      <a class="btn btn-outline" href="tel:+919999999999">Call Us</a>
    </div>
  </div>
</main>

<section>
  <div class="container grid">
    <div class="card"><h3>About Us</h3><p>Know our school, vision, and team.</p><a class="btn btn-outline" href="#about">Read more</a></div>
    <div class="card"><h3>Admissions</h3><p>Process, documents, and fee structure.</p><a class="btn btn-outline" href="#admissions">View details</a></div>
    <div class="card"><h3>Image Gallery</h3><p>Photos of school life and events.</p><a class="btn btn-outline" href="#gallery">See photos</a></div>
  </div>
</section>

<section id="about">
  <div class="container">
    <h2 class="section-title">About Us</h2>
    <div class="card">
      <p>Rising Stars Public School serves children of <strong>Village Shyampur, P.O. Gorkhuwala, Tehsil Paonta Sahib, District Sirmour, Himachal Pradesh – 173025</strong>.</p>
      <p>Our guiding principle <strong>Parampara : Prodyogiki : Prakastha</strong> means: Parampara (traditions), Prodyogiki (technology), Prakastha (excellence).</p>
    </div>
  </div>
</section>

<section id="admissions">
  <div class="container">
    <h2 class="section-title">Admissions</h2>
    <div class="card">
      <p>Admissions open. Visit the office with Aadhaar, birth certificate, TC (if any), and recent photos, or send an enquiry below.</p>
      <p><strong>Fee Structure:</strong> Contact the office for latest details.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <a class="btn" href="#enquiry">Submit Enquiry</a>
        <a class="btn btn-outline" href="mailto:rspsshyampur@gmail.com">Email Admissions</a>
      </div>
    </div>
  </div>
</section>

<section id="gallery">
  <div class="container">
    <h2 class="section-title">Image Gallery</h2>
    <div class="gallery" aria-label="School photos">
      <img alt="School event photo 1" src="https://picsum.photos/seed/school1/600/400"/>
      <img alt="School event photo 2" src="https://picsum.photos/seed/school2/600/400"/>
      <img alt="School event photo 3" src="https://picsum.photos/seed/school3/600/400"/>
      <img alt="School event photo 4" src="https://picsum.photos/seed/school4/600/400"/>
      <img alt="School event photo 5" src="https://picsum.photos/seed/school5/600/400"/>
      <img alt="School event photo 6" src="https://picsum.photos/seed/school6/600/400"/>
      <img alt="School event photo 7" src="https://picsum.photos/seed/school7/600/400"/>
      <img alt="School event photo 8" src="https://picsum.photos/seed/school8/600/400"/>
    </div>
  </div>
</section>

<section id="enquiry">
  <div class="container">
    <h2 class="section-title">Enquiry (पूछताछ)</h2>
    <p class="small" style="margin-bottom:10px;">Fill the form below. You can also WhatsApp us—click the green button.</p>
    <form class="enquiry" onsubmit="return enquirySubmit(event)">
      <div><label for="name">Parent Name</label><input id="name" name="name" placeholder="Your full name" required/></div>
      <div><label for="phone">Phone Number</label><input id="phone" name="phone" pattern="[0-9]{10}" placeholder="10-digit mobile" required/></div>
      <div><label for="student">Student Name</label><input id="student" name="student" placeholder="Child's name"/></div>
      <div>
        <label for="class">Class Interested</label>
        <select id="class" name="class">
          <option>Nursery</option><option>LKG</option><option>UKG</option>
          <option>Class 1</option><option>Class 2</option><option>Class 3</option><option>Class 4</option><option>Class 5</option>
          <option>Class 6</option><option>Class 7</option><option>Class 8</option>
        </select>
      </div>
      <textarea id="message" name="message" placeholder="Your question (e.g., fees, transport, timing)"></textarea>
      <div class="actions">
        <button class="btn" type="submit">Send Enquiry</button>
        <a class="btn" id="waLink" target="_blank" rel="noopener" style="background:var(--accent);" href="#">WhatsApp Us</a>
        <a class="btn btn-outline" href="mailto:rspsshyampur@gmail.com?subject=Admission%20Enquiry">Email Us</a>
      </div>
      <p class="small">Note: We will call you back within 1 working day.</p>
    </form>
  </div>
</section>

<section id="contact">
  <div class="container contact">
    <div class="info">
      <h2 class="section-title">Contact Us</h2>
      <p><strong>Address:</strong><br/>Rising Stars Public School,<br/>Village Shyampur, P.O. Gorkhuwala,<br/>Tehsil Paonta Sahib, District Sirmour,<br/>Himachal Pradesh – 173025</p>
      <p><strong>Email:</strong> <a href="mailto:rspsshyampur@gmail.com">rspsshyampur@gmail.com</a></p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <a class="btn" href="tel:+919999999999">Call Now</a>
        <a class="btn btn-outline" href="#map">Open Map</a>
      </div>
    </div>
    <div class="card" id="map" aria-label="Map placeholder">
      <p style="margin-top:0;">Map will appear here.</p>
      <img alt="Map placeholder" src="https://maps.googleapis.com/maps/api/staticmap?center=Paonta%20Sahib,HP&zoom=12&size=600x300&markers=color:blue|Paonta%20Sahib" style="width:100%;height:auto;border-radius:12px;border:1px solid #e5e7eb"/>
    </div>
  </div>
</section>

<!-- LOGIN -->
<section id="login">
  <div class="container">
    <h2 class="section-title">User Login</h2>
    <p class="small" style="margin-bottom:8px;">Choose your role to log in.</p>

    <div class="tabs" role="tablist" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
      <button id="studentTabBtn" class="tab active" role="tab" aria-controls="studentTab" aria-selected="true" onclick="showTab('student')" style="padding:8px 12px;border:1px solid #c7d2fe;background:#eef2ff;border-radius:10px;cursor:pointer;font-weight:700;">Parent</button>
      <button id="teacherTabBtn" class="tab" role="tab" aria-controls="teacherTab" aria-selected="false" onclick="showTab('teacher')" style="padding:8px 12px;border:1px solid #c7d2fe;background:#eef2ff;border-radius:10px;cursor:pointer;font-weight:700;">Teacher</button>
      <button id="accountsTabBtn" class="tab" role="tab" aria-controls="accountsTab" aria-selected="false" onclick="showTab('accounts')" style="padding:8px 12px;border:1px solid #c7d2fe;background:#eef2ff;border-radius:10px;cursor:pointer;font-weight:700;">Accounts</button>
      <button id="adminTabBtn" class="tab" role="tab" aria-controls="adminTab" aria-selected="false" onclick="showTab('admin')" style="padding:8px 12px;border:1px solid #c7d2fe;background:#eef2ff;border-radius:10px;cursor:pointer;font-weight:700;">Admin</button>
    </div>

    <div class="login-grid" style="display:grid;gap:16px;grid-template-columns:1fr;">

      <!-- Parent -->
      <div id="studentTab" role="tabpanel" aria-labelledby="studentTabBtn">
        <div class="card">
          <h3>Parent Login</h3>
          <form class="login" onsubmit="return false" style="display:grid;gap:10px;">
            <label for="studentPhone">Parent Email</label>
            <input id="studentPhone" placeholder="Enter parent email" required/>
            <label for="studentOtp">Password</label>
            <input id="studentOtp" type="password" placeholder="Enter password" required/>
            <button class="btn" type="submit">Login</button>
            <p class="small"><a href="#" id="parentForgot">Forgot password?</a></p>
            <p id="studentError" class="error" hidden style="color:#ef4444;font-size:13px;">Login failed.</p>
          </form>
        </div>
      </div>

      <!-- Teacher -->
      <div id="teacherTab" role="tabpanel" aria-labelledby="teacherTabBtn" hidden>
        <div class="card">
          <h3>Teacher Login</h3>
          <form class="login" onsubmit="return false" style="display:grid;gap:10px;">
            <label for="tphone">Teacher Email</label>
            <input id="tphone" placeholder="Enter teacher email" required/>
            <label for="tpass">Password</label>
            <input id="tpass" type="password" placeholder="Enter password" required/>
            <button class="btn" type="submit">Login</button>
            <p class="small"><a href="#" id="teacherForgot">Forgot password?</a></p>
            <p id="teacherError" class="error" hidden style="color:#ef4444;font-size:13px;">Login failed.</p>
          </form>
        </div>
      </div>

      <!-- Accounts -->
      <div id="accountsTab" role="tabpanel" aria-labelledby="accountsTabBtn" hidden>
        <div class="card">
          <h3>Accounts Login</h3>
          <form class="login" onsubmit="return false" style="display:grid;gap:10px;">
            <label for="acctUser">Accounts Email</label>
            <input id="acctUser" placeholder="Enter accounts email" required/>
            <label for="acctPass">Password</label>
            <input id="acctPass" type="password" placeholder="Enter password" required/>
            <button class="btn" type="submit">Login</button>
            <p class="small"><a href="#" id="accountsForgot">Forgot password?</a></p>
            <p id="accountsError" class="error" hidden style="color:#ef4444;font-size:13px;">Login failed.</p>
          </form>
        </div>

        <!-- Demo-only Quick Fees Console kept as-is -->
        <div class="card" style="margin-top:12px;">
          <h3>Quick Fees Console (Demo)</h3>
          <form class="login" onsubmit="return false" style="display:grid;gap:10px;">
            <label for="acctAdm">Admission No.</label>
            <input id="acctAdm" placeholder="RSPS/2025/0123"/>
            <label for="acctMonth">Month</label>
            <input id="acctMonth" placeholder="e.g., July 2025"/>
            <label for="acctAmount">Amount (₹)</label>
            <input id="acctAmount" type="number" step="1" min="0" placeholder="e.g., 1200"/>
            <label for="acctMode">Mode</label>
            <input id="acctMode" placeholder="UPI / NEFT / Cash"/>
            <label for="acctUtr">UTR/Ref (optional)</label>
            <input id="acctUtr" placeholder="Bank ref no."/>
            <div class="actions" style="display:flex;gap:10px;flex-wrap:wrap;">
              <button class="btn btn-outline" type="button" onclick="alert('Demo: Payment recorded (not saved).')">Record Payment (Demo)</button>
              <button class="btn" type="button" onclick="alert('Demo: Receipt PDF generated.')">Generate Receipt (Demo)</button>
            </div>
            <p class="small" style="color:#6b7280;">Note: Front-end demo only. Real ledger + PDF will be wired after dashboards.</p>
          </form>
        </div>
      </div>

      <!-- Admin -->
      <div id="adminTab" role="tabpanel" aria-labelledby="adminTabBtn" hidden>
        <div class="card">
          <h3>Admin Login</h3>
          <form class="login" onsubmit="return false" style="display:grid;gap:10px;">
            <label for="aemail">Admin Email</label>
            <input id="aemail" type="email" placeholder="admin@example.com" required/>
            <label for="apass">Password</label>
            <input id="apass" type="password" placeholder="Enter password" required/>
            <button class="btn" type="submit">Login</button>
            <p class="small"><a href="#" id="adminForgot">Forgot password?</a></p>
            <p id="adminError" class="error" hidden style="color:#ef4444;font-size:13px;">Login failed.</p>
          </form>
        </div>
      </div>

    </div>

    <script>
      function showTab(which){
        const tabs=['student','teacher','accounts','admin'];
        tabs.forEach(t=>{
          document.getElementById(t+'Tab').hidden=(t!==which);
          const btn=document.getElementById(t+'TabBtn');
          if(!btn) return;
          btn.classList.toggle('active', t===which);
          btn.setAttribute('aria-selected', t===which ? 'true':'false');
        });
      }
    </script>
  </div>
</section>

<footer>
  <div class="container foot">
    <div>
      <img alt="Rising Stars Logo" class="logo" src="Rising Stars logo RSPS png.png" style="height:50px;"/>
      <p class="small">Serving our rural community with care and quality education. Our motto – <strong>Parampara : Prodyogiki : Prakastha</strong>.<br/>Address: Village Shyampur, P.O. Gorkhuwala, Tehsil Paonta Sahib, District Sirmour, Himachal Pradesh – 173025</p>
    </div>
    <div>
      <strong>Quick Links</strong>
      <ul class="small" style="list-style:none;padding-left:0;">
        <li><a href="#about">About Us</a></li>
        <li><a href="#admissions">Admissions</a></li>
        <li><a href="#gallery">Image Gallery</a></li>
        <li><a href="#enquiry">Enquiry</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </div>
    <div>
      <strong>Contact</strong>
      <p class="small">Email: <a href="mailto:rspsshyampur@gmail.com">rspsshyampur@gmail.com</a><br/>Phone: (to be updated)</p>
    </div>
  </div>
  <div class="container" style="margin-top:12px;">
    <p class="small">© <span id="year"></span> Rising Stars Public School. All rights reserved.</p>
  </div>
</footer>

<!-- Supabase + Auth logic -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const sb = supabase.createClient(
    "https://eqbbddsjutlupckqzlpq.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxYmJkZHNqdXRsdXBja3F6bHBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NDkzOTMsImV4cCI6MjA3MDIyNTM5M30.CVmsiBCCp98ZQQOEe-1QgrvcJGeRP4DGHUx6j0wPCRI"
  );

  function toggleMenu(){ document.getElementById('mobileMenu').classList.toggle('open'); }
  document.getElementById('year').textContent = new Date().getFullYear();

  // Enquiry → WhatsApp helper
  function enquirySubmit(e){
    e.preventDefault();
    const n = document.getElementById('name').value.trim();
    const p = document.getElementById('phone').value.trim();
    const s = document.getElementById('student').value.trim();
    const c = document.getElementById('class').value;
    const m = document.getElementById('message').value.trim();
    const text = encodeURIComponent(`Enquiry:\nParent: ${n}\nPhone: ${p}\nStudent: ${s}\nClass: ${c}\nMsg: ${m}`);
    const wa = `https://wa.me/919999999999?text=${text}`;
    document.getElementById('waLink').href = wa;
    alert('Thanks! We will get back to you soon.');
    return false;
  }

  // Helpers and role redirects
  async function getMyProfile(userId){
    const { data, error } = await sb.from('profiles').select('full_name, role').eq('user_id', userId).single();
    if (error) throw error; return data;
  }
  function goRole(role){
    if (role==='admin') location.href='admin-dashboard.html';
    else if (role==='accounts') location.href='accounts-dashboard.html';
    else if (role==='teacher') location.href='teacher-dashboard.html';
    else if (role==='parent') location.href='parent-dashboard.html';
    else alert('Unknown role: '+role);
  }
  function showErr(elId, err){
    console.error(err);
    const el = document.getElementById(elId);
    if (!el) { alert(err?.message || 'Login failed'); return; }
    el.hidden=false; el.textContent=(err?.message||'Login failed');
    setTimeout(()=>{ el.hidden=true; }, 6000);
  }

  // Admin
  const adminForm = document.querySelector("#adminTab form.login");
  if (adminForm) adminForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("aemail").value.trim();
    const pass  = document.getElementById("apass").value;
    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
      const user = data.user;
      const p = await getMyProfile(user.id);
      if (p.role !== "admin") throw new Error("This user is not an admin");
      goRole(p.role);
    } catch (err) { showErr("adminError", err); }
  });

  // Accounts
  const accountsForm = document.querySelector("#accountsTab form.login");
  if (accountsForm) accountsForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("acctUser").value.trim();
    const pass  = document.getElementById("acctPass").value;
    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
      const user = data.user;
      const p = await getMyProfile(user.id);
      if (p.role !== "accounts") throw new Error("This user is not accounts role");
      goRole(p.role);
    } catch (err) { showErr("accountsError", err); }
  });

  // Teacher
  const teacherForm = document.querySelector("#teacherTab form.login");
  if (teacherForm) teacherForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("tphone").value.trim();
    const pass  = document.getElementById("tpass").value;
    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
      const user = data.user;
      const p = await getMyProfile(user.id);
      if (p.role !== "teacher") throw new Error("This user is not teacher role");
      goRole(p.role);
    } catch (err) { showErr("teacherError", err); }
  });

  // Parent
  const parentForm = document.querySelector("#studentTab form.login");
  if (parentForm) parentForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("studentPhone").value.trim();
    const pass  = document.getElementById("studentOtp").value;
    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
      const user = data.user;
      const p = await getMyProfile(user.id);
      if (p.role !== "parent") throw new Error("This user is not parent role");
      goRole(p.role);
    } catch (err) { showErr("studentError", err); }
  });

  // Forgot password → email reset link with redirect to reset.html
  function recoveryRedirect(){ return `${location.origin}${location.pathname.replace(/[^/]*$/,'')}reset.html`; }
  function bindForgot(linkId, getEmail){
    const a = document.getElementById(linkId);
    if(!a) return;
    a.addEventListener('click', async (e)=>{
      e.preventDefault();
      const email = (getEmail()||'').trim();
      if(!email) return alert('Enter your email in the form first.');
      const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: recoveryRedirect() });
      alert(error ? ('Error: '+error.message) : 'Password reset email sent. Please check your inbox.');
    });
  }
  bindForgot('adminForgot',   ()=>document.getElementById('aemail').value);
  bindForgot('accountsForgot',()=>document.getElementById('acctUser').value);
  bindForgot('teacherForgot', ()=>document.getElementById('tphone').value);
  bindForgot('parentForgot',  ()=>document.getElementById('studentPhone').value);
</script>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const sb = supabase.createClient(
    "https://eqbbddsjutlupckqzlpq.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxYmJkZHNqdXRsdXBja3F6bHBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NDkzOTMsImV4cCI6MjA3MDIyNTM5M30.CVmsiBCCp98ZQQOEe-1QgrvcJGeRP4DGHUx6j0wPCRI"
  );

  async function routeAfterLogin() {
    const { data:{ user } } = await sb.auth.getUser();
    if (!user) return;
    const { data:p } = await sb.from('profiles').select('role').eq('user_id', user.id).single();
    if (!p) { alert('No profile/role found for this user. Ask admin to create one in profiles.'); return; }
    const role = p.role;
    if (role === 'admin') location.href = 'admin-dashboard.html';
    else if (role === 'accounts') location.href = 'accounts-dashboard.html';
    else if (role === 'teacher') location.href = 'teacher-dashboard.html';
    else if (role === 'parent') location.href = 'parent-dashboard.html';
    else alert('Unknown role in profiles: '+role);
  }

  // Attach to each login form (email+password)
  const bindLogin = (emailId, passId, errorId) => {
    const email = document.getElementById(emailId);
    const pass  = document.getElementById(passId);
    const err   = document.getElementById(errorId);
    if (!email || !pass) return;
    email.form.onsubmit = async (e)=>{
      e.preventDefault();
      err.hidden = true;
      const { error } = await sb.auth.signInWithPassword({ email: email.value.trim(), password: pass.value });
      if (error) { err.hidden=false; err.textContent = error.message; }
      else { routeAfterLogin(); }
    };
  };
  bindLogin('studentPhone','studentOtp','studentError');   // parent
  bindLogin('tphone','tpass','teacherError');              // teacher
  bindLogin('acctUser','acctPass','accountsError');        // accounts
  bindLogin('aemail','apass','adminError');                // admin

  // Forgot password -> send reset to reset.html
  const sendReset = (btnId, getEmailId) => {
    const btn = document.getElementById(btnId);
    if (!btn) return;
    btn.onclick = async (e)=>{
      e.preventDefault();
      const email = document.getElementById(getEmailId).value.trim();
      if(!email) return alert('Enter your email in the box first.');
      const { error } = await sb.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin.replace(/\/+$/,'') + '/reset.html'
      });
      if (error) alert(error.message);
      else alert('Reset link sent. Please check your inbox/spam.');
    };
  };
  sendReset('parentForgot','studentPhone');
  sendReset('teacherForgot','tphone');
  sendReset('accountsForgot','acctUser');
  sendReset('adminForgot','aemail');

  // If already logged in, auto-route (nice for returning users)
  sb.auth.getSession().then(({ data:{ session } })=>{
    if(session) routeAfterLogin();
  });
</script>


</body>
</html>
